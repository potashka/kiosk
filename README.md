# Kiosk

## Система Управления Сменами и Простоями Оборудования

### Описание
Это веб-приложение предназначено для управления сменами рабочих и отслеживания простоев оборудования на производстве. Оно позволяет пользователям регистрировать начало и окончание смен, а также управлять простоями оборудования.

### Основные функции
- **Аутентификация и управление сессиями пользователей**
- **Управление сменами и простоями через веб-интерфейс**
- **Динамическое отображение и обновление статусов оборудования**

### Технологии
- **FastAPI**: для создания веб-сервера и API.
- **SQLAlchemy** (Async): для асинхронной работы с базой данных.
- **PostgreSQL**: в качестве системы управления базами данных.
- **Uvicorn**: ASGI сервер для запуска приложения.

### Запуск проекта
1. Установите Python 3.9 или выше.
2. Откройте терминал или подключитесь к серверу через SSH. Проверьте версию Git, чтобы узнать, установлен ли он. Введите следующую команду: `git --version`. Если Git не установлен, то при попытке выполнить команду git --version, вы увидите сообщение об ошибке. 

Для установки Git можно использовать команды, соответствующие вашей операционной системе на сервере.
Например для Ubuntu/Debian:

`sudo apt update`
`sudo apt install git`

После установки гита клонируйте репозиторий на сервер `git clone https://github.com/potashka/kiosk.git`

3. Создайте виртуальное окружение и активируйте его.
4. Установите зависимости: `pip install -r requirements.txt`
5. Запустите проект: 

Например,  `uvicorn app.main:app --reload --port 8080` или

`uvicorn app.main:app --reload --host 0.0.0.0 --port 8080` для внешнего хоста

### Структура проекта
- `/app`: основная директория с исходным кодом.
  - `database.py`: конфигурация базы данных (url базы данных)
  - `dependencies.py`: зависимости приложения, включая сессии базы данных.
  - `models.py`: модели базы данных.
  - `main.py`: основной файл приложения с маршрутами API.
- `/templates`: HTML шаблоны для интерфейса пользователя.
- `/static`: статические файлы, такие как CSS.

### Логика работы системы

#### Аутентификация и выбор смены

1. **Выбор цеха:** Оператор выбирает цех из списка. Информация о цехах загружается из базы данных.
2. **Получение списка пользователей:** После выбора цеха на киоске отображается список операторов.
3. **Вход в систему:** Оператор выбирает своё имя из списка и вводит пароль для входа.
4. **Выход из системы:** Можно выйти из системы нажатием кнопки или после тайм-аута.

#### Работа в системе

1. **Постановка на смену:** На дашборде отображается список станков. Оператор может встать на смену или завершить её.
2. **Журнал простоев:** Рядом с каждым станком есть кнопка для просмотра журнала простоев.
3. **Причины простоев:** Оператор может выбрать причину простоя из списка и сохранить информацию.

### API Эндпоинты
- **GET `/`**: приветственная страница.
- **GET `/select-group`**: выбор группы пользователем.
- **POST `/set-group`**: установка выбранной группы в сессию пользователя.
- **GET `/select-user`**: выбор пользователя для аутентификации.
- **POST `/login`**: вход пользователя в систему.
- **GET `/logout`**: выход пользователя из системы.
- **GET `/dashboard/{group_id}`**: панель управления для отображения оборудования.
- **GET `/equipment/{group_id}`**: получение списка оборудования по группе.
- **POST `/toggle-equipment/{equipment_id}`**: переключение статуса оборудования.
- **GET `/downtimes/{equipment_id}`**: получение списка простоев оборудования.
- **POST `/update-downtime/{equipment_id}/{start_id}`**: обновление информации о простое.
- **GET `/answers`**: получение списка возможных ответов для оборудования.

### JavaScript в dashboard.html
В dashboard.html используется JavaScript для управления элементами пользовательского интерфейса, такими как кнопки переключения статуса оборудования и отображение информации о простоях. Скрипт асинхронно обращается к серверу за данными об оборудовании, обновляет информацию на странице без перезагрузки и обрабатывает пользовательские действия, такие как переключение статусов и обновление причин простоев.

### Примеры использования
- **Переключение статуса оборудования**: Пользователи могут включать и выключать оборудование через интерфейс, что инициирует POST запрос на `/toggle-equipment/{equipmentId}`.
- **Управление простоями**: При нажатии на кнопку "Простои", скрипт запрашивает данные о простоях для конкретного оборудования и отображает их. Пользователи могут выбирать причины простоев из выпадающего списка, что отправляет POST запрос на `/update-downtime/{equipmentId}/{startId}`.

### Заключение
Это приложение представляет собой инструмент для управления производственными процессами, обеспечивая простоту в использовании и высокую степень кастомизации для конкретных производственных нужд.

