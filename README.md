# kiosk

# Система Управления Сменами и Простоями Оборудования

## Описание

Данный проект представляет собой веб-приложение, предназначенное для управления сменами рабочих и отслеживания простоев оборудования на производстве. Приложение позволяет рабочим входить в систему, регистрировать время начала и окончания смен, а также выбирать и регистрировать простои из предопределённого списка.

### Вход в Систему и Регистрация Смены:

Пользователи должны иметь возможность входить в систему, используя данные из существующей таблицы users.
Регистрировать время начала (check-in) и окончания (check-out) своих рабочих смен.

- Фиксация Простоев:

Во время работы пользователи сталкиваются с простоями оборудования.
Для учета этих простоев используется существующая таблица workflow, где фиксируются временные интервалы простоев.

- Назначение Типов Простоев:

Пользователи должны иметь возможность привязывать каждый зарегистрированный простой к конкретному типу простоя, определенному в таблице answers_list.
Новые Таблицы для Регистрации Данных:


## Цели и Требования:

Не изменять существующие таблицы базы данных, чтобы не нарушать работу уже существующих функций и данных.
Реализовать указанную функциональность таким образом, чтобы она интегрировалась с текущими данными и логикой приложения.

Обеспечить простоту внедрения новых функций и поддерживать возможность масштабирования приложения в будущем.

### Техническая Реализация:

- Использовать SQLAlchemy для работы с базой данных и управления миграциями.
- Использовать FastAPI для создания веб-сервера и обработки запросов.
- Создать новые таблицы на старте приложения с помощью Base.metadata.create_all(engine), если они еще не существуют, для обеспечения необходимой структуры данных.

## Технологии

- **FastAPI**: Современный, быстрый (высокопроизводительный) веб-фреймворк для создания API с Python 3.7+ на основе стандартных типов Python.
- **SQLAlchemy**: Библиотека SQL Toolkit и Object-Relational Mapping (ORM) для языка программирования Python, которая дает полный контроль и гибкость в работе с базой данных.
- **PostgreSQL**: Мощная объектно-реляционная система управления базами данных.
- **Uvicorn**: ASGI сервер для запуска и обслуживания веб-приложения.

## Структура проекта
- /static/css: Содержит CSS файлы для стилизации веб-интерфейса.
- /templates: Содержит HTML-шаблоны для веб-интерфейса пользователя.
- /app: Основная директория FastAPI приложения, содержит исходный код Python.
    - database.py: Настройки подключения к базе данных.
    - main.py: Основной файл приложения, содержит определения API-маршрутов.
    - dependencies.py: Зависимости приложения, такие как сессии базы данных.
    - models.py: Новые модели

## Схема взаимодействия
- Аутентификация: Пользователи входят в систему, используя свои учетные данные.
- Регистрация смены: Пользователи могут регистрировать начало и окончание своих смен.
- Управление простоями: Пользователи выбирают простои из списка и назначают их текущей задаче на оборудовании.

## API Эндпоинты

- `POST /login`: Аутентификация пользователей и начало сессии.
- `GET /equipment/`: Возвращает список оборудования.
- `GET /workflow/{equipment_id}`: Получение информации о работе и простоях выбранного оборудования.
- `POST /assign_downtime/`: Регистрация простоя оборудования с указанием типа простоя из `answers_list`.

Эти эндпоинты обеспечивают основную функциональность системы управления сменами и простоями, позволяя пользователям взаимодействовать с базой данных и регистрировать необходимую информацию в реальном времени.

## Интеграция с базой данных

Подключение к базе данных осуществляется через SQLAlchemy, что позволяет использовать как ORM, так и прямые SQL-запросы для управления данными.

### Таблицы базы данных

- **users**: Хранит информацию о пользователях системы.
- **workflow**: Содержит данные о рабочих операциях и простоях оборудования.
- **answers_list**: Включает список предопределённых ответов или категорий простоев.

### Javascript в dashboard.html

### Инициализация и отображение списка оборудования:

JavaScript код делает запрос к `/equipment/{groupId}`, что соответствует обработчику `get_equipment`. Этот обработчик возвращает список оборудования для указанной группы, которое затем динамически отображается в HTML.

### Переключение статуса оборудования:

При нажатии на кнопку "Переключить" (`toggle-equipment`) вызывается JavaScript функция `toggleEquipment`, которая в свою очередь делает POST-запрос к `/toggle-equipment/{equipmentId}`. Это соответствует обработчику `toggle_equipment` в вашем FastAPI приложении, который изменяет статус активности оборудования и возвращает результат операции.

### Загрузка и отображение информации о простоях:

При нажатии на кнопку "Простои" (`downtime-button`) вызывается функция `loadDowntimes`, делающая запрос к `/downtimes/{equipmentId}`, соответствующему обработчику `get_downtimes`. Этот обработчик извлекает и возвращает информацию о простоях для указанного оборудования.

### Обновление причины простоя:

Функция `showAnswers` загружает возможные ответы для обновления причины простоя через запрос к `/answers`, что соответствует обработчику `get_answers`. Затем пользователь может выбрать ответ из выпадающего списка, который затем используется функцией `updateDowntime` для отправки POST-запроса на `/update-downtime/{equipmentId}/{startId}`. Это соответствует обработчику `update_downtime`, который обновляет информацию о простое.


Эти таблицы позволяют эффективно управлять данными о сменах и простоях, улучшая процессы мониторинга и аналитики.

## Запуск проекта

### Настройка виртуального окружения

Перед началом работы над проектом рекомендуется настроить виртуальное окружение для изоляции зависимостей. Это можно сделать следующим образом:

1. Установите Python 3.7 или выше, если он ещё не установлен.
2. Создайте новое виртуальное окружение:bash
   - python -m venv venv
   - source venv/bin/activate  для Linux
   - или .\venv\Scripts\activate для Windows

### Установка зависимостей

pip install -r requirements.txt

### Запуск проекта
uvicorn app.main:app --reload

## Структура проекта




